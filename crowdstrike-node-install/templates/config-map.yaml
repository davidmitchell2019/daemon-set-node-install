apiVersion: v1
kind: ConfigMap
metadata:
  name: entrypoint
  labels:
    app: default-init
data:
  entrypoint.sh: |
    #!/usr/bin/env bash
    set -euo pipefail
    DEBIAN_FRONTEND=noninteractive
    ROOT_MOUNT_DIR="${ROOT_MOUNT_DIR:-/root}"
    wget crowdstrike.deb from nexus
    mv crowdstrike.deb /root
    # We use chroot to run the following commands in the host root (mounted as the /root volume in the container)
    chroot "${ROOT_MOUNT_DIR}" sudo dpkg -i crowdstrike.deb
    chroot "${ROOT_MOUNT_DIR}" sudo /opt/CrowdStrike/falconctl -s --cid=<CID>
    chroot "${ROOT_MOUNT_DIR}" sudo dpkg -i crowdstrike.deb
    chroot "${ROOT_MOUNT_DIR}" systemctl start falcon-sensor
    chroot "${ROOT_MOUNT_DIR}" ps -e | grep falcon-sensor